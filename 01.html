<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è¨˜æ†¶é…å°å°éŠæˆ²ï¼ˆé—œå¡ç‰ˆï¼‰</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: #f5f7fb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }
    .info {
      display: flex;
      gap: 18px;
      margin-bottom: 12px;
      font-size: 16px;
    }
    button, select {
      margin: 6px;
      padding: 6px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .board {
      display: grid;
      gap: 12px;
      margin-top: 10px;
    }
    .card {
      width: 80px;
      height: 80px;
      perspective: 600px;
      cursor: pointer;
    }
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.4s;
      transform-style: preserve-3d;
    }
    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card.matched { pointer-events: none; }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      border-radius: 12px;
    }
    .card-front { background: #4f46e5; color: white; }
    .card-back {
      background: white;
      transform: rotateY(180deg);
      border: 2px solid #e5e7eb;
    }
    /* éŠæˆ²æ„Ÿ UI */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
    }
    .overlay.show { display: flex; }
    .dialog {
      background: white;
      padding: 24px 32px;
      border-radius: 16px;
      text-align: center;
      min-width: 260px;
      animation: pop 0.25s ease;
    }
    @keyframes pop {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .fail-flash {
      animation: flash 0.4s ease 2;
    }
    @keyframes flash {
      0% { background: #f5f7fb; }
      50% { background: #fee2e2; }
      100% { background: #f5f7fb; }
    }
  </style>
</head>
<body>

<h1>è¨˜æ†¶é…å°ï¼ˆé—œå¡åˆ¶ï¼‰</h1>

<div class="info">
  <div>ğŸ¯ é—œå¡ï¼š<span id="level">1</span></div>
  <div>â± æ™‚é–“ï¼š<span id="time">0</span>s</div>
  <div>â¤ï¸ å‰©é¤˜æ¬¡æ•¸ï¼š<span id="moves">0</span></div>
  <div>â­ é…å°ï¼š<span id="score">0</span></div>
</div>

<div>
  <button onclick="resetGame()">é‡æ–°é–‹å§‹</button>
  <select id="difficulty" onchange="changeDifficulty()">
    <option value="4">4Ã—4ï¼ˆç°¡å–®ï¼‰</option>
    <option value="5">5Ã—5ï¼ˆå›°é›£ï¼‰</option>
  </select>
</div>

<div class="board" id="board"></div>

<!-- å¤±æ•—æç¤º -->
<div class="overlay" id="failOverlay">
  <div class="dialog">
    <h3 id="failText">å¤±æ•—</h3>
    <button onclick="retryLevel()">å†è©¦ä¸€æ¬¡</button>
  </div>
</div>



<script>
  // âš ï¸ åœ–æ¡ˆä¾†æºï¼ˆæ•¸é‡ä¸€å®šè¦ â‰¥ æœ€å¤§é…å°æ•¸ï¼‰
  // 6Ã—6 éœ€è¦ 18 ç¨®åœ–æ¡ˆï¼Œé€™è£¡æº–å‚™ 30 å€‹ï¼Œé¿å…å‡ºç¾ç©ºç™½
  // ä½¿ç”¨ã€Œä¿è­‰å¯é¡¯ç¤ºã€çš„æ–‡å­—ç¬¦è™Ÿï¼Œé¿å… emoji åœ¨æŸäº›è£ç½®é¡¯ç¤ºå¤±æ•—
  // ä½¿ç”¨ã€Œéè”¬æœé¡ emojiã€ï¼Œé¿å…éƒ¨åˆ†æ°´æœåœ¨è£ç½®ä¸Šç„¡æ³•é¡¯ç¤º
  const allSymbols = [
    'ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯',
    'ğŸ¦','ğŸ®','ğŸ·','ğŸ¸','ğŸµ','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¦„',
    'â­','ğŸŒ™','â˜€ï¸','âš¡','ğŸ”¥','ğŸ’§','â„ï¸','ğŸŒˆ','ğŸˆ','ğŸµ'
  ];

  let boardSize = 4; // 4 æˆ– 5
  let level = 1;
  let maxMoves = 0;
  let movesLeft = 0;
  let score = 0;
  let firstCard = null;
  let lockBoard = false;
  let time = 0;
  let timerId = null;

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function startTimer() {
    clearInterval(timerId);
    time = 0;
    document.getElementById('time').innerText = time;
    timerId = setInterval(() => {
      time++;
      document.getElementById('time').innerText = time;
    }, 1000);
  }

  function setupLevel() {
    if (boardSize === 4) {
      maxMoves = Math.max(10, 16 - level * 2);
    } else {
      maxMoves = Math.max(20, 30 - level * 2);
    }
    movesLeft = maxMoves;
    score = 0;
    document.getElementById('level').innerText = level;
    document.getElementById('moves').innerText = movesLeft;
    document.getElementById('score').innerText = score;
  }

  function createBoard() {
    const board = document.getElementById('board');
    board.innerHTML = '';
    board.style.gridTemplateColumns = `repeat(${boardSize}, 80px)`;
    firstCard = null;
    lockBoard = false;

    setupLevel();

    // 5Ã—5 æ˜¯å¥‡æ•¸æ ¼ï¼Œæœƒå¤š 1 å¼µã€Œè‡ªå‹•å®Œæˆå¡ã€
    const pairCount = Math.floor((boardSize * boardSize) / 2);
    const symbols = shuffle(allSymbols).slice(0, pairCount);
    const cards = shuffle([...symbols, ...symbols]);

    // å¦‚æœæ˜¯ 5Ã—5ï¼ŒåŠ å…¥ä¸€å¼µå…é…å°å¡
    if (boardSize === 5) {
      cards.push('â­');
    }

    cards.forEach(symbol => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-inner">
          <div class="card-front">?</div>
          <div class="card-back">${symbol}</div>
        </div>
      `;
      card.addEventListener('click', () => flipCard(card, symbol));
      if (symbol === 'â­') {
        card.classList.add('matched', 'flipped');
      }
      board.appendChild(card);
    });

    startTimer();
    
  }

  function flipCard(card, symbol) {
    if (lockBoard || card.classList.contains('flipped')) return;

    card.classList.add('flipped');

    if (!firstCard) {
      firstCard = { card, symbol };
      return;
    }

    if (firstCard.symbol === symbol) {
      // é…å°æˆåŠŸ
      card.classList.add('matched');
      firstCard.card.classList.add('matched');
      score++;
      document.getElementById('score').innerText = score;
      firstCard = null;

      if (score === Math.floor((boardSize * boardSize) / 2)) {
        clearInterval(timerId);
        setTimeout(() => {
          level++;
          createBoard();
        }, 500);
      }
    } else {
      // é…å°å¤±æ•—
      lockBoard = true;
      movesLeft--;
      document.getElementById('moves').innerText = movesLeft;

      setTimeout(() => {
        card.classList.remove('flipped');
        firstCard.card.classList.remove('flipped');
        firstCard = null;
        lockBoard = false;

        if (movesLeft <= 0) {
          clearInterval(timerId);
          document.body.classList.add('fail-flash');
          const overlay = document.getElementById('failOverlay');
          document.getElementById('failText').innerText = `ç¬¬ ${level} é—œå¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡`;
          overlay.classList.add('show');
        }
      }, 800);
    }
  }

  function resetGame() {
    level = 1;
    hideFail();
    createBoard();
  }

  function changeDifficulty() {
    boardSize = parseInt(document.getElementById('difficulty').value);
    resetGame();
  }

  function retryLevel() {
    hideFail();
    createBoard();
  }

  function hideFail() {
    document.getElementById('failOverlay').classList.remove('show');
    document.body.classList.remove('fail-flash');
  }

  

  

  createBoard();
</script>

</body>
</html>
