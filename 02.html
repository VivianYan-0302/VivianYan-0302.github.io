<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è¨˜æ†¶é…å°å°éŠæˆ²ï¼ˆé—œå¡åˆ¶ï¼‰</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: #f5f7fb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }

    .info {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      font-size: 16px;
    }

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    button, select {
      margin: 6px;
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }

    .board {
      display: grid;
      gap: 12px;
      margin-top: 10px;
    }

    .card {
      width: 80px;
      height: 80px;
      perspective: 600px;
      cursor: pointer;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.4s;
      transform-style: preserve-3d;
    }

    .card.flipped .card-inner { transform: rotateY(180deg); }
    .card.matched { pointer-events: none; }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      border-radius: 12px;
    }

    .card-front { background: #4f46e5; color: white; }
    .card-back {
      background: white;
      transform: rotateY(180deg);
      border: 2px solid #e5e7eb;
    }

    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    #overlay .box {
      background: white;
      padding: 28px 36px;
      border-radius: 16px;
      text-align: center;
      min-width: 260px;
    }
  </style>
</head>
<body>

<h1>è¨˜æ†¶é…å°ï¼ˆé—œå¡åˆ¶ï¼‰</h1>

<div class="info">
  <div>ğŸ¯ é—œå¡ï¼š<span id="level">1</span></div>
  <div>â± æ™‚é–“ï¼š<span id="time">0</span>s</div>
  <div>â¤ï¸ å‰©é¤˜æ¬¡æ•¸ï¼š<span id="moves">0</span></div>
  <div>â­ é…å°æˆåŠŸï¼š<span id="score">0</span></div>
</div>

<div class="controls">
  <button onclick="location.reload()">é‡æ–°æ•´ç†</button>
  <button onclick="restartAll()">é‡æ–°é—–é—œ</button>
  <select id="difficulty" onchange="changeDifficulty()">
    <option value="4">4Ã—4ï¼ˆæ¨™æº–ï¼‰</option>
    <option value="5">5Ã—5ï¼ˆå›°é›£ï¼‰</option>
  </select>
</div>

<div class="board" id="board"></div>

<div id="overlay">
  <div class="box">
    <h2 id="overlayText">ğŸ® éŠæˆ²é–‹å§‹</h2>
    <button id="overlayBtn" onclick="overlayAction()">â–¶ï¸ é–‹å§‹éŠæˆ²</button>
  </div>
</div>

<script>
  const allSymbols = [
    'ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯',
    'ğŸ¦','ğŸ®','ğŸ·','ğŸ¸','ğŸµ','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¦„',
    'â­','ğŸŒ™','â˜€ï¸','âš¡','ğŸ”¥','ğŸ’§','â„ï¸','ğŸŒˆ','ğŸˆ','ğŸµ'
  ];

  let boardSize = 4; // 4 æˆ– 5
  let level = 1;
  let score = 0;
  let movesLeft = 0;
  let firstCard = null;
  let lockBoard = false;
  let timer = 0;
  let timerId = null;
  let state = 'start'; // start | playing | fail | clear

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function startTimer() {
    clearInterval(timerId);
    timer = 0;
    document.getElementById('time').innerText = timer;
    timerId = setInterval(() => {
      timer++;
      document.getElementById('time').innerText = timer;
    }, 1000);
  }

  function setupLevel() {
    score = 0;
    movesLeft = 15;
    document.getElementById('level').innerText = level;
    document.getElementById('score').innerText = score;
    document.getElementById('moves').innerText = movesLeft;
    startTimer();
  }

  function createBoard() {
    const board = document.getElementById('board');
    board.innerHTML = '';
    board.style.gridTemplateColumns = `repeat(${boardSize}, 80px)`;
    firstCard = null;
    lockBoard = false;

    setupLevel();

    let pairCount = Math.floor((boardSize * boardSize) / 2);

    // 5Ã—5 æ¨¡å¼ï¼šé ç•™ 1 å¼µç‰¹æ®Šå¡
    let hasSpecial = false;
    if (boardSize === 5) {
      pairCount = Math.floor((boardSize * boardSize - 1) / 2);
      hasSpecial = true;
    }((boardSize * boardSize) / 2);
    const symbols = shuffle([...allSymbols]).slice(0, pairCount);
    let cards = shuffle([...symbols, ...symbols]);

    if (hasSpecial) {
      cards.push('ğŸ”·'); // ç‰¹æ®Šé è¨­å¡
    }([...symbols, ...symbols]);

    cards.forEach(symbol => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-inner">
          <div class="card-front">?</div>
          <div class="card-back">${symbol}</div>
        </div>`;

      if (hasSpecial && symbol === 'ğŸ”·') {
        card.classList.add('flipped', 'matched');
      } else {
        card.addEventListener('click', () => flipCard(card, symbol));
      }

      board.appendChild(card);
    });(symbol => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-inner">
          <div class="card-front">?</div>
          <div class="card-back">${symbol}</div>
        </div>`;
      card.addEventListener('click', () => flipCard(card, symbol));
      board.appendChild(card);
    });
  }

  function flipCard(card, symbol) {
    if (lockBoard || card.classList.contains('flipped') || state !== 'playing') return;

    card.classList.add('flipped');

    if (!firstCard) {
      firstCard = { card, symbol };
      return;
    }

    if (firstCard.symbol === symbol) {
      card.classList.add('matched');
      firstCard.card.classList.add('matched');
      score++;
      document.getElementById('score').innerText = score;
      firstCard = null;

      if (score === Math.floor((boardSize * boardSize) / 2)) {
        // ç­‰æœ€å¾Œä¸€å¼µç‰Œç¿»é–‹å‹•ç•«å®Œæˆå¾Œæ‰çµæŸ
        setTimeout(() => {
          clearInterval(timerId);
          state = 'clear';
          showOverlay(`ç¬¬ ${level} é—œçµæŸ`, 'â¡ï¸ ä¸‹ä¸€é—œ');
        }, 450);
      }
    } else {
      lockBoard = true;
      movesLeft--;
      document.getElementById('moves').innerText = movesLeft;

      if (movesLeft <= 0) {
        clearInterval(timerId);
        state = 'fail';
        showOverlay(`ç¬¬ ${level} é—œå¤±æ•—`, 'ğŸ” å¾æ–°éé—œ');
      }

      setTimeout(() => {
        card.classList.remove('flipped');
        firstCard.card.classList.remove('flipped');
        firstCard = null;
        lockBoard = false;
      }, 800);
    }
  }

  function showOverlay(text, btnText) {
    document.getElementById('overlayText').innerText = text;
    document.getElementById('overlayBtn').innerText = btnText;
    document.getElementById('overlay').style.display = 'flex';
  }

  function overlayAction() {
    document.getElementById('overlay').style.display = 'none';

    if (state === 'start') {
      state = 'playing';
    } else if (state === 'clear') {
      level++;
      state = 'playing';
    } else if (state === 'fail') {
      state = 'playing';
    }

    createBoard();
  }

  function changeDifficulty() {
    boardSize = parseInt(document.getElementById('difficulty').value);
    level = 1;
    state = 'start';
    clearInterval(timerId);
    showOverlay('ğŸ® éŠæˆ²é–‹å§‹', 'â–¶ï¸ é–‹å§‹éŠæˆ²');
  }

  function restartAll() {
    level = 1;
    state = 'start';
    clearInterval(timerId);
    showOverlay('ğŸ® éŠæˆ²é–‹å§‹', 'â–¶ï¸ é–‹å§‹éŠæˆ²');
  }

  // åˆå§‹ç•«é¢
  showOverlay('ğŸ® éŠæˆ²é–‹å§‹', 'â–¶ï¸ é–‹å§‹éŠæˆ²');
</script>

</body>
</html>
