<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>è¨˜æ†¶é…å°å°éŠæˆ²ï¼ˆé—œå¡åˆ¶ï¼‰</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      background: #f5f7fb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 { margin-bottom: 10px; }

    .info {
      display: flex;
      gap: 18px;
      margin-bottom: 12px;
      font-size: 16px;
    }

    button, select {
      margin: 6px;
      padding: 8px 16px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }

    .board {
      display: grid;
      gap: 12px;
      margin-top: 10px;
    }

    .card {
      width: 80px;
      height: 80px;
      perspective: 600px;
      cursor: pointer;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.4s;
      transform-style: preserve-3d;
    }

    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card.matched {
      pointer-events: none;
    }

    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      border-radius: 12px;
    }

    .card-front {
      background: #4f46e5;
      color: white;
    }

    .card-back {
      background: white;
      transform: rotateY(180deg);
      border: 2px solid #e5e7eb;
    }

    /* é–‹å§‹ / éé—œç•«é¢ */
    #levelClear {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    #levelClear .box {
      background: white;
      padding: 28px 36px;
      border-radius: 16px;
      text-align: center;
      min-width: 260px;
    }
  </style>
</head>
<body>

<h1>è¨˜æ†¶é…å°ï¼ˆé—œå¡åˆ¶ï¼‰</h1>

<div class="info">
  <div>ğŸ¯ é—œå¡ï¼š<span id="level">1</span></div>
  <div>â­ é…å°ï¼š<span id="score">0</span></div>
</div>

<div>
  <button onclick="resetGame()">é‡æ–°é–‹å§‹</button>
  <select id="difficulty" onchange="changeDifficulty()">
    <option value="4">4Ã—4ï¼ˆç°¡å–®ï¼‰</option>
    <option value="5">5Ã—5ï¼ˆå›°é›£ï¼‰</option>
  </select>
</div>

<div class="board" id="board"></div>

<!-- é–‹å§‹ / éé—œç•«é¢ -->
<div id="levelClear">
  <div class="box">
    <h2 id="clearText">ğŸ® éŠæˆ²é–‹å§‹</h2>
    <button id="nextBtn" onclick="nextLevel()">â–¶ï¸ é–‹å§‹éŠæˆ²</button>
  </div>
</div>

<script>
  // ç©©å®šé¡¯ç¤ºçš„éè”¬æœ emoji
  const allSymbols = [
    'ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼','ğŸ¨','ğŸ¯',
    'ğŸ¦','ğŸ®','ğŸ·','ğŸ¸','ğŸµ','ğŸ”','ğŸ§','ğŸ¦','ğŸ¤','ğŸ¦„',
    'â­','ğŸŒ™','â˜€ï¸','âš¡','ğŸ”¥','ğŸ’§','â„ï¸','ğŸŒˆ','ğŸˆ','ğŸµ'
  ];

  let boardSize = 4;
  let level = 1;
  let score = 0;
  let firstCard = null;
  let lockBoard = false;
  let gameStarted = false;

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function setupLevel() {
    score = 0;
    document.getElementById('level').innerText = level;
    document.getElementById('score').innerText = score;
  }

  function createBoard() {
    const board = document.getElementById('board');
    board.innerHTML = '';
    board.style.gridTemplateColumns = `repeat(${boardSize}, 80px)`;
    firstCard = null;
    lockBoard = false;

    setupLevel();

    const pairCount = Math.floor((boardSize * boardSize) / 2);
    const symbols = shuffle([...allSymbols]).slice(0, pairCount);
    const cards = shuffle([...symbols, ...symbols]);

    // 5Ã—5 å¤šä¸€å¼µè‡ªå‹•å®Œæˆå¡
    if (boardSize === 5) cards.push('â­');

    cards.forEach(symbol => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="card-inner">
          <div class="card-front">?</div>
          <div class="card-back">${symbol}</div>
        </div>
      `;

      if (boardSize === 5 && symbol === 'â­') {
        card.classList.add('flipped', 'matched');
      } else {
        card.addEventListener('click', () => flipCard(card, symbol));
      }

      board.appendChild(card);
    });
  }

  function flipCard(card, symbol) {
    if (lockBoard || card.classList.contains('flipped')) return;

    card.classList.add('flipped');

    if (!firstCard) {
      firstCard = { card, symbol };
      return;
    }

    if (firstCard.symbol === symbol) {
      card.classList.add('matched');
      firstCard.card.classList.add('matched');
      score++;
      document.getElementById('score').innerText = score;
      firstCard = null;

      if (score === Math.floor((boardSize * boardSize) / 2)) {
        document.getElementById('clearText').innerText = `ğŸ‰ ç¬¬ ${level} é—œçµæŸ`;
        document.getElementById('nextBtn').innerText = 'â¡ï¸ ä¸‹ä¸€é—œ';
        document.getElementById('levelClear').style.display = 'flex';
      }
    } else {
      lockBoard = true;
      setTimeout(() => {
        card.classList.remove('flipped');
        firstCard.card.classList.remove('flipped');
        firstCard = null;
        lockBoard = false;
      }, 800);
    }
  }

  function nextLevel() {
    document.getElementById('levelClear').style.display = 'none';

    if (!gameStarted) {
      gameStarted = true;
      level = 1;
    } else {
      level++;
    }

    createBoard();
  }

  function resetGame() {
    level = 1;
    gameStarted = false;
    document.getElementById('clearText').innerText = 'ğŸ® éŠæˆ²é–‹å§‹';
    document.getElementById('nextBtn').innerText = 'â–¶ï¸ é–‹å§‹éŠæˆ²';
    document.getElementById('levelClear').style.display = 'flex';
    createBoard();
  }

  function changeDifficulty() {
    boardSize = parseInt(document.getElementById('difficulty').value);
    resetGame();
  }

  // ä¸€é–‹å§‹åªé¡¯ç¤ºé–‹å§‹ç•«é¢
  document.getElementById('levelClear').style.display = 'flex';
</script>

</body>
</html>
